# تعليمات مخصّصة لـ GitHub Copilot — مشروع almasjid

هذه التعليمات موجّهة إلى Copilot لكي يلتزم بها تلقائيًا داخل هذا المستودع. الهدف: مخرجات عربية موجزة، كود Flutter/Dart نظيف متوافق مع أدوات المشروع، مع مراعاة الأداء، الأمان، والاختبارات.

## أسلوب الردود
- استخدم العربية الفصحى بصياغة موجزة وواضحة.
- اجعل الأكواد قابلة للتشغيل قدر الإمكان، وركّز على الأجزاء المطلوبة دون حشو.
- عند توليد تغييرات داخل المشروع، التزم ببنية المجلدات الحاليّة وأسماء الملفات.

## قواعد عامّة لـ Flutter/Dart
- التزم بـ null-safety، واستخدم `const` قدر الإمكان لتقليل إعادة البناء.
- فضّل `StatelessWidget` إن لم تكن هناك حالة داخلية؛ اجزئ الواجهات الكبيرة إلى Widgets أصغر.
- التزم بالتنسيق الافتراضي (dart format) وبقواعد `flutter_lints` (v5) ما أمكن.
- أنماط التسمية: `snake_case` للملفات، `PascalCase` للأصناف و`lowerCamelCase` للمتغيرات والدوال.
- لا تُدخل تبعيات جديدة إلا للضرورة ومع تبرير واضح. إن لزم، فضّل الحِزم الشائعة والموثوقة صغيرة الحجم.

## الحِزم والبنية في المشروع
- استخدم الحِزم الموجودة في `pubspec.yaml` فقط (مثل: get/get_it، dio، intl، flutter_svg، lottie، إلخ).
- DI وإدارة الحالة: استخدم GetX مع GetBuilder في الواجهات الافتراضيًا، وObx فقط لنطاقات صغيرة تتطلب تفاعلية لحظية. احترم الأسلوب القائم (GetX و/أو get_it) وتجنّب خلط الأنماط دون حاجة.
- الشبكات: 
  - استخدم `dio` مع مهلات مناسبة، وتعامل مع الأخطاء بوضوح (رسائل ودّية ومسارات فشل). 
  - إن لزم، استخدم Interceptors للتسجيل/إعادة المحاولة بحذر.
- التخزين/الكاش: استخدم الحِزم الموجودة مثل `flutter_cache_manager` و`get_storage` عند الحاجة.
  
  ملاحظة: اعتمد على `lib/core/services/api_client.dart` و`lib/core/services/error_handling_system.dart` للشبكات ومعالجة الأخطاء بدل إنشاء عملاء/معالجات جدد.

## الترجمة والمحلية (i18n)
- لا تضع نصوصًا صلبة داخل الواجهات. استخدم `intl` أو نظام المفاتيح في `assets/locales/*.json`.
- عند إضافة نصوص جديدة، أضف مفاتيح واضحة وقابلة للفهم، وتجنّب التكرار.

## الواجهات والأداء
- استخدم `const`، و`const constructors`، و`Gap` من الحزمة `gap` بدل `SizedBox` للمسافات، و`const Icons` حيثما أمكن.
- تجنّب العمليات الثقيلة داخل `build`؛ استخدم Memoization أو نقل المنطق خارج الواجهة.
- افصل منطق العمل عن الواجهة، وحافظ على Widgets نحيفة.

### إعادة استخدام الملفات الموجودة (بدل إنشاء جديدة)
- الشبكات والأخطاء:
  - `lib/core/services/api_client.dart` — عميل الشبكة الموحّد (Dio).
  - `lib/core/services/error_handling_system.dart` — نظام توحيد الأخطاء وإرجاع Failure.
- الخلفية والإشعارات:
  - `lib/core/services/background_services.dart` — تهيئة وجدولة مهام الخلفية.
  - `lib/core/services/prayer_background_manager.dart` — مهام الخلفية الخاصة بالصلوات والكاش.
  - `lib/core/services/notifications_helper.dart` — التهيئة والجدولة لقنوات الإشعارات.
  - `lib/core/services/notifications_manager.dart` — منطق إدارة تكرار/تقليل الإشعارات.
- الاتصال بالشبكة:
  - `lib/core/services/connectivity_service.dart` — خدمة تتبّع الاتصال باستخدام GetX.
- تكامل المنصات:
  - `lib/core/services/macos_widget_service.dart` — تكامل ويدجت macOS.

عند الحاجة لوظائف ضمن هذه المجالات، أعد استخدام هذه الملفات وتوسيعها بدل إنشاء ملفات/خدمات جديدة.

## الأذونات والموقع
- احترام خصوصية المستخدم. لا تطلب أذونات إلا عند الحاجة الفعلية وبسياق واضح داخل الواجهة.

## الأمان
- لا تُضمّن أسرارًا أو مفاتيح API في الكود. استخدم آليات آمنة للتهيئة السرية.
- تجنّب طباعة بيانات حساسة في السجلات (logs) في إصدارات الإنتاج.

## الاختبارات
- لكل ميزة/دالة عامة جديدة: أضف اختبارًا بسيطًا (happy path) وحالة حافة واحدة على الأقل باستخدام `flutter_test`.
- اجعل الاختبارات سريعة ومحدّدة، وتجنب الاعتماد على الشبكة المباشرة دون تهيئة/محاكاة.

## التوثيق والصيانة
- أضف تعليقات قصيرة فقط عندما يكون المنطق غير بديهي، ويفضّل توثيق العقود (المدخلات/المخرجات والأخطاء المتوقعة).
- عند تغييرات عامة، حافظ على سجل موجز لما تغيّر ولماذا.

## طلبات خاصة عند التوليد
- إن احتجت ملفات جديدة، اقترح الأسماء والمسارات بما يتوافق مع هيكلة `lib/` الحالية.
- لا تعيد تهيئة أو إعادة هيكلة واسعة إلا عند طلب صريح.
- قدّم مثال تشغيل/استدعاء صغير بعد كلّ دالة/Widget جديدة إن أمكن.

> تذكير: التزم بالحِزم والأساليب المعتمدة حاليًا في المشروع، وتجنّب إدخال أنماط جديدة دون داعٍ.
